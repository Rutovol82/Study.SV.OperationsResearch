# Проект
**ТЕМА: "_ВИЗНАЧЕННЯ НАЙКРАЩОГО КУРСУ ЯХТИ В ЗАКРИТІЙ АКВАТОРІЇ_"**




## Презентація проєкту

[![**[Ілюстрація: титульний слайд презентації / клікабельна]**](docs/images/presentation-title.png)](docs/presentation.pptx)  
[_завантажити_](docs/presentation.pptx)



## Ідея проєкту


### Передбачення швидкостей

  Для розрахунку орієнтовних швидкостей яхти в залежності від курсу та швидкості вітру, пакет [`pysailing`](pysailing/) за замовчуванням використовує функцію лінійної інтерполяції, що спирається на дані вимірювань (або розрахунків) швидкостей яхти на різних курсах для різної швидкості вітру.

  Дані цих вимірювань передаються до програми через спеціальні csv-файли параметрів судна, що містять таблицю швидкостей (швидкості яхти та вітру задаються у вузлах, кути - у градусах) наступного вигляду:

  ```
  twa/tws;6;8;10;12;14;16;20
  0;0;0;0;0;0;0;0
  52;9.16;10.7;11.3;11.77;12.2;12.74;13.39
  60;9.85;11.16;11.88;12.47;12.93;13.46;14.34
  75;10.4;11.69;12.81;13.54;14.12;14.63;16.15
  90;10.35;11.65;13.13;14.33;15.21;15.99;17.14
  110;9.64;11.34;12.62;13.64;15.15;16.92;19.02
  120;9.19;11.07;12.55;13.92;15.01;16.18;18.98
  135;7.93;10.12;11.44;12.92;14.62;16.47;19.26
  150;6.53;8.44;9.98;11.12;12.39;14.02;17.65 
  ```

  Ці дані парсяться та зберігаються в об'єкти класу `VelocityMeasurements` з пакету [`pysailing`](pysailing/). Потім на їч основі можна створити об'єкт для отримання інтерпольованих даних класу `VelocityParameters`.

  Важливим архітектурним моментом є те, що і `VelocityMeasurements`, і `VelocityParameters` реалізують уніфкований інтерфейс `VelocityGetter`, що визначає метод `getv()` для отримання швидкостей з об'єкту з наступним синтаксисом:

  ```getv(self, degree, wind: float, mode: str)```

  Де:  
  * `degree` - курсовий кут у градусах або радіанах
  * `wind` - реальна швидкість вітру (_True wind speed_) у візлах
  * `mode` - рядок, що може приймати значення `deg` - якщо кут переданий у градусах, або `rad` - якщо у радіанах.

  Безпосередньо для інтерполяції даних, для зручності, було використано можливості пакету `scipy`. За замовчуванням використовується клас `scipy.interpolate.LinearNDInterpolator`, однак у разі необхідності його можна замінити будь-яким іншим класом із аналогічним інтерфейсом (див. файл [`_VelocityParameters.py`](pysailing/_VelocityParameters.py)).


### Геометрична модель

  В основу поточної версії проєкту покладено простий геометричний алгоритм перебору та оцінки кутів лавірування.

  В основу геометричної моделі покладено задачу наступного вигляду:

  ![**[Ілюстрація: малюнок до геометричної задачі]**](docs/images/geometry_base.png)  

  Тут:
    
  * Вектор ___C___ - відповідає генеральному курсу судна, що з'єднує пункт відправлення ___A___ та пункт  призначення ___B___.
  * Вектор ___W___ - відповідає напрямку вітру.
  * Кут ___&delta;___ - кут "заходу" на траєкторію лавірування
  * Кут ___&rho;___ - кут "виходу" з траєкторії лавірування
  * Кут ___&alpha;___ - шуканий кут лавірування, який обчислюється наступним чином: 
    > ___&alpha;___ = ___&delta;___ + ___&rho;___

  Таким чином, перебираючи кути ___&delta;___ і ___&rho;___ та обчислюючи, користуючись оцінкою швидкостей, очікуваний час проходження деякої умовної одиничної для кожної комбінації кутів, маємо змогу, використовуючи отримані дані в якоті "оцінки" кута, визначити "найкращий" кут лавірування ___&alpha;___.

  > **ВАЖЛИВО**  
  >
  > Поточна версія проєкту є доволі примітивною і виконана в умовах жорсткої нестачі робочого часу.  
  >
  > Зокрема, в поточній версії проєкту не враховуються час або втрата швидкості під час виконання поворотів, що може вплинути на отримані результати.

  > **ДО УВАГИ**  
  >
  > Нова версія проєкту на основі нового пакету `pysailing2` зараз перебуває на стадії розробки.
  >
  > У новій, повністю переробленій версії, планується реалізувати втрати часу на поворотах, розрахунок кількості поворотів в залежності від максимально допустимого відходу від генерального курсу, а також повністю переробити всю об'єктну модель і програмну логіку. 



## Користування проєктом

Проєкт складається з двох основних частин - пакета [`pysailing`](pysailing/), що містить основні класи для зберігання даних, розрахунку швидкостей та кутів, та скрипт [`main.py`](main.py), що реалізує використання цього пакету та імплементує функціональність проєкту.


### Передавання вхідних даних

  Вхідні дані задаються в тексті [`main.py`](main.py):

  ```
  GET_PARAMS_NAME = lambda boat: f'{boat}.csv'
  PARAMS_FOLDER = ".work/sailboats"

  BOAT = "Avance 24"

  MIN_ANGLE = 0.1

  WIND_COURSE_ANGLE = 8
  WIND_KNOTS_SPEED = 11

  DISPLAY_LEVELS = 50
  ```

  Тут:
  
  * `GET_PARAMS_NAME` - функція, що перетворія назву/ідентифікатор судна на назву csv-файла з його параметрами.
  * `PARAMS_FOLDER` - шлях до каталогу, де зберігаються файли з парметрами суден
  * `BOAT` - назва або ідентифікатор судна
  * `MIN_ANGLE` - мінімальний кут лавірування, який буде розглядати програма (окрім 0°)
  * `WIND_COURSE_ANGLE` - напрямок вітру відносно курсу судна (курс судна відносно вітру)
  * `WIND_KNOTS_SPEED` - швидкість вітру у вузлах
  * `DISPLAY_LEVELS` - кількість рівнів відображення даних моделі на вихідних діаграмах (рівні градуються відносно показників для "найкращого" кута, дані, що виходять за межі шкали, не відображаються)


### Результати роботи програми

Після запуску скрипту [`main.py`](main.py) отримаємо вікно з графіками `matplotlib` наступного вигляду:

![**[Ілюстрація: результатти роботи програми]**](docs/images/script_demo_01.png)  

На цьому скріншоті справа і зліва можемо бачити діаграми з результататми роботи моделі: зліва - для випадку заходу на траєкторію лавіруваня з лівим поворотом, а справа - із правим. Над цими діаграмами також підписано умови (напрямок та швидкість вітру) та розрахований "найкращий кут лавірування". По центру можемо бачити побудовану полярну діаграму швидкостей для обраного судна.



## Ліцензія

Згідно правил гарного тону, до проєкту додано ліцензію.  
Усі файли в теці [`project`](./) пдлягають дії [__MIT License__](./LICENSE).



## Посилання за темою

* Ресурси з даними для побудови полярних діаграм швидкостей яхт

  * [___OCR Sailboat Data (2022)___](https://jieter.github.io/orc-data/site/) - 
    веб-сайт, що парсить з [_OCR.org_](https://orc.org/) дані для побудови полярних діаграм яхт та надає иожливість переглядати вигляд цих діаграм, 
    а також завантажувати відповідні дані в `.csv` форматі
  
  * [___OCR.org___](https://orc.org/) -
    офіційний веб-сайт _Offshore Racing Congress_ - міжнародної організації, відповідальної за встановлення та підтримку рейтингових та кваліфікаційних стандартів у вітрильному спорті.
    Серед іншого містить великий архів кваліфікаційних даних вітрильних яхт, а також даних з вітрильних перегонів.

* VPP (_Velocity Prediction Program_) з ввідкритим вихідним кодом

  * **[_Python-VPP_](https://github.com/marinlauber/Python-VPP) / License: [_MIT_](https://github.com/marinlauber/Python-VPP/blob/master/LICENSE)** - 
    open-source проєкт VPP на Python.
  
  * **[_gvpp_](https://sourceforge.net/projects/gvpp/) / License: [_GPLv2_](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html)** - 
    a Matlab library for sailing boat performance simulation. 
  
  * **[_VPP_]() / License: _unlicensed_** -
    a Matlab project, implements VPP for sailing yachts. 
    